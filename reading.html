<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$2 Mini Reading</title>

  <link href="style.css" rel="stylesheet">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Load your main app (Firebase init, cart, etc.) -->
  <script type="module" src="app.js"></script>
</head>

<body>
  <!-- NAVBAR (matches your store style) -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top mb-3">
    <div class="container">
      <a class="navbar-brand" href="index.html">Store Name</a>

      <form class="searchBar d-flex mt-3" role="search" action="search.html" method="GET">
        <input id="searchInput" name="q" class="form-control me-2" type="search" placeholder="Search" aria-label="Search" />
        <button title="Search" class="btn btn-outline-success" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </form>

      <a title="Cart" href="cart.html" type="button">
        <i class="cart bi bi-cart4 position-relative"></i>
        <span id="cartBadge" class="top-0 start-100 translate-middle badge rounded-pill bg-danger"></span>
      </a>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <div class="container mb-5">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-8">

        <div class="card shadow-sm">
          <div class="card-body">
            <h2 class="card-title mb-2 text-center">$2 Mini Reading</h2>
            <p class="text-muted text-center mb-4">
              A short, intuitive mini reading delivered straight to your email.
            </p>

            <!-- STEP 1: Payment -->
            <div class="mb-4">
              <h5 class="mb-2">Step 1 — Pay $2 for your reading</h5>
              <p class="text-muted small mb-2">
                Click the button below to pay for your reading. After you’ve paid, come back to this page and complete the form.
              </p>

              <!-- TODO: Replace this link with your real Stripe / PayPal payment link -->
              <a
                href="https://example.com/your-payment-link"
                target="_blank"
                rel="noopener"
                class="btn btn-success w-100 mb-2"
              >
                Pay $2 for Reading
              </a>

              <div class="form-check mt-2">
                <input class="form-check-input" type="checkbox" value="" id="paidCheckbox">
                <label class="form-check-label" for="paidCheckbox">
                  I have completed my $2 payment.
                </label>
              </div>
            </div>

            <hr>

            <!-- STEP 2: Info Form -->
            <h5 class="mb-3">Step 2 — Tell me about your reading</h5>

            <form id="readingForm" novalidate>
              <div class="mb-3">
                <label for="nameInput" class="form-label">Your Name</label>
                <input type="text" class="form-control" id="nameInput" required>
              </div>

              <div class="mb-3">
                <label for="emailInput" class="form-label">Your Email (where I’ll send your reading)</label>
                <input type="email" class="form-control" id="emailInput" required>
              </div>

              <div class="mb-3">
                <label for="topicInput" class="form-label">What would you like the reading to focus on?</label>
                <textarea class="form-control" id="topicInput" rows="4" required
                  placeholder="Example: Love, career crossroads, healing past trauma, next steps on my path..."></textarea>
              </div>

              <div class="mb-3">
                <label for="extraInput" class="form-label">Anything else I should know? (optional)</label>
                <textarea class="form-control" id="extraInput" rows="3"></textarea>
              </div>

              <button type="submit" class="btn btn-primary w-100">
                Submit Reading Request
              </button>
            </form>

            <!-- Success / error messages -->
            <div id="readingMessage" class="mt-3 small"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- JS: Save reading request to Firestore -->
  <script type="module">
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const db = getFirestore();

    const form = document.getElementById("readingForm");
    const msgEl = document.getElementById("readingMessage");
    const paidCheckbox = document.getElementById("paidCheckbox");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      msgEl.textContent = "";
      msgEl.className = "mt-3 small";

      // Basic form validation
      const name = document.getElementById("nameInput").value.trim();
      const email = document.getElementById("emailInput").value.trim();
      const topic = document.getElementById("topicInput").value.trim();
      const extra = document.getElementById("extraInput").value.trim();

      if (!paidCheckbox.checked) {
        msgEl.textContent = "Please confirm you have completed the $2 payment before submitting.";
        msgEl.classList.add("text-danger");
        return;
      }

      if (!name || !email || !topic) {
        msgEl.textContent = "Please fill in your name, email, and reading focus.";
        msgEl.classList.add("text-danger");
        return;
      }

      try {
        await addDoc(collection(db, "readings"), {
          name,
          email,
          topic,
          extra,
          createdAt: serverTimestamp(),
          status: "pending",     // you can update this later in admin when completed
          paid: true             // trusting checkbox; real validation would be done server-side
        });

        form.reset();
        paidCheckbox.checked = false;

        msgEl.textContent = "Thank you! Your reading request has been received. I’ll send your reading to your email soon.";
        msgEl.classList.add("text-success");
      } catch (err) {
        console.error("Error saving reading:", err);
        msgEl.textContent = "Something went wrong saving your request. Please try again in a moment.";
        msgEl.classList.add("text-danger");
      }
    });
  </script>

</body>
</html>
